<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackBun Burgers</title>

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#0f1116;
    color:white;
}

/* HEADER */
header{
    background:#12151c;
    padding:15px 30px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

header h1{
    color:#f6c177;
    margin:0;
}

button{
    background:#f6c177;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}

/* MENU */
.container{
    max-width:1100px;
    margin:auto;
    padding:20px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;
}

.card{
    background:#171a22;
    padding:20px;
    border-radius:12px;
    border:1px solid #2a2f3a;
}

.card h3{ margin:0 0 10px }
.price{ color:#f6c177; font-weight:bold }

/* CARRITO */
.cart{
    position:fixed;
    right:0;
    top:0;
    height:100%;
    width:320px;
    background:#12151c;
    padding:20px;
    overflow:auto;
    transform:translateX(100%);
    transition:.3s;
}

.cart.open{ transform:translateX(0); }

input,textarea{
    width:100%;
    padding:8px;
    border-radius:8px;
    border:none;
    margin-bottom:10px;
}
</style>
</head>
<body>

<header>
<h1>üçî BlackBun</h1>
<button onclick="toggleCart()">Carrito (<span id="count">0</span>)</button>
</header>

<div class="container">
<h2>Men√∫</h2>
<div id="menu" class="grid"></div>
</div>

<div id="cart" class="cart">
<h2>Pedido</h2>

<div id="items"></div>
<h3>Total: $<span id="total">0</span></h3>

<input id="nombre" placeholder="Tu nombre">
<input id="telefono" placeholder="Tu WhatsApp">
<textarea id="nota" placeholder="Notas"></textarea>

<button onclick="enviar()">Enviar por WhatsApp</button>
</div>

<script>
/* ========= CONFIG ========= */
const MENU_URL =
"https://script.google.com/macros/s/AKfycbxN7uXn2y4CZMRHeMmpg525be0izu1WF2indrM8vBJq75HBxnl9kb-BtR52lCGMSMCT0g/exec";

const WHATSAPP_RESTAURANTE = "5215567864301";

let menuData={currency:"MXN",items:[]};
let cart={};

/* ===== JSONP (evita CORS) ===== */
function loadMenu(){
return new Promise((resolve,reject)=>{
const cb="menuCB_"+Date.now();

window[cb]=(data)=>{
menuData=data;
delete window[cb];
resolve(data);
};

const s=document.createElement("script");
s.src=`${MENU_URL}?callback=${cb}&t=${Date.now()}`;
s.onerror=reject;
document.body.appendChild(s);
});
}

/* ===== MENU ===== */
function renderMenu(){
const menu=document.getElementById("menu");
menu.innerHTML="";

menuData.items.forEach(i=>{
menu.innerHTML+=`
<div class="card">
<h3>${i.name}</h3>
<p>${i.desc||""}</p>
<div class="price">$${i.price}</div>
<button onclick="add('${i.id}')">Agregar</button>
</div>`;
});
}

/* ===== CARRITO ===== */
function add(id){
cart[id]=(cart[id]||0)+1;
renderCart();
}

function renderCart(){
const cont=document.getElementById("items");
const totalEl=document.getElementById("total");
const count=document.getElementById("count");

cont.innerHTML="";
let total=0,c=0;

for(let id in cart){
const item=menuData.items.find(i=>i.id==id);
if(!item) continue;

const qty=cart[id];
const sub=item.price*qty;

total+=sub;
c+=qty;

cont.innerHTML+=`<p>${qty}x ${item.name} - $${sub}</p>`;
}

totalEl.textContent=total;
count.textContent=c;
}

function toggleCart(){
document.getElementById("cart").classList.toggle("open");
}

/* ===== WHATSAPP ===== */
function enviar(){
const nombre=document.getElementById("nombre").value.trim();
const tel=document.getElementById("telefono").value.trim();
const nota=document.getElementById("nota").value.trim();

if(!nombre||!tel){
alert("Escribe nombre y WhatsApp");
return;
}

let msg=`üçî *Nuevo pedido*%0A`;
msg+=`Cliente: ${nombre}%0A`;
msg+=`Tel: ${tel}%0A%0A`;

for(let id in cart){
const item=menuData.items.find(i=>i.id==id);
msg+=`${cart[id]}x ${item.name}%0A`;
}

if(nota) msg+=`%0ANota: ${encodeURIComponent(nota)}`;

window.open(
`https://wa.me/${WHATSAPP_RESTAURANTE}?text=${msg}`,
"_blank"
);
}

/* ===== INIT ===== */
loadMenu()
.then(()=>renderMenu())
.catch(()=>alert("Error cargando men√∫"));
</script>

</body>
</html>
